{% extends "base.html" %}
{% load static %}

{% block title %}Gifter‚Äôs{% endblock %}
{% block body_class %}index-page{% endblock %}

{% block content %}

<!-- Hero Section -->
<section id="hero" class="hero section light-background">
  <div class="container">
    <div class="row gy-4">
      <div class="col-lg-12 d-flex flex-column justify-content-center align-items-center text-center"
        data-aos="zoom-out">
        <h1>
          Bienvenido a <span class="brand">Gifter‚Äôs</span>
          <img src="{% static 'img/Gifters/favicongift.png' %}" alt="Logo Gifter‚Äôs" class="inline-logo">
        </h1>
        <p>‚ÄúConecta, descubre y regala momentos √∫nicos.‚Äù</p>
        <div class="d-flex justify-content-center gap-3 mt-3">
          <a href="#portfolio" class="gift">Empieza a buscar regalos</a>
        </div>
      </div>
    </div>
  </div>
</section>

<section id="featured-services" class="featured-services section">
  <div class="container">
    <div class="row gy-4">

      <div class="col-xl-3 col-md-6 d-flex" data-aos="fade-up" data-aos-delay="100">
        <div class="service-item position-relative">
          <div class="icon"><i class="bi bi-heart-fill icon" style="color:#6c63ff;"></i></div>
          <h4><a href="#portfolio" class="stretched-link">Regala cari√±o</a></h4>
          <p>Un detalle sincero vale m√°s que mil palabras.</p>
        </div>
      </div>

      <div class="col-xl-3 col-md-6 d-flex" data-aos="fade-up" data-aos-delay="200">
        <div class="service-item position-relative">
          <div class="icon"><i class="bi bi-gift-fill icon" style="color:#6c63ff;"></i></div>
          <h4><a href="#portfolio" class="stretched-link">El detalle perfecto</a></h4>
          <p>Encuentra ideas √∫nicas que sorprenden a quienes m√°s quieres.</p>
        </div>
      </div>

      <div class="col-xl-3 col-md-6 d-flex" data-aos="fade-up" data-aos-delay="300">
        <div class="service-item position-relative">
          <div class="icon"><i class="bi bi-stars icon" style="color:#6c63ff;"></i></div>
          <h4><a href="#portfolio" class="stretched-link">Hazlo especial</a></h4>
          <p>No importa el tama√±o del regalo, importa la emoci√≥n que transmite.</p>
        </div>
      </div>

      <div class="col-xl-3 col-md-6 d-flex" data-aos="fade-up" data-aos-delay="400">
        <div class="service-item position-relative">
          <div class="icon"><i class="bi bi-people-fill icon" style="color:#6c63ff;"></i></div>
          <h4><a href="#portfolio" class="stretched-link">Conecta personas</a></h4>
          <p>Regalar es compartir momentos que se quedan para siempre.</p>
        </div>
      </div>

    </div>
  </div>
</section>



<!-- Categor√≠as recomendadas -->
<div class="container section-title" data-aos="fade-up">
  <h2>Categor√≠as</h2>
  <p><span>&nbsp;</span> <span class="description-title">Explora nuestras categor√≠as</span></p>
</div>

<!-- Clients Section - CATEGOR√çAS DIN√ÅMICAS CON FLECHAS -->
<section id="clients" class="clients section light-background categorias-carousel">
  <div class="container">
    {% if categorias %}
    <div class="swiper init-swiper">
      <script type="application/json" class="swiper-config">
        {
          "loop": true,
          "speed": 600,
          "autoplay": { "delay": 5000 },
          "slidesPerView": "auto",
          "pagination": { 
            "el": ".swiper-pagination", 
            "type": "bullets", 
            "clickable": true 
          },
          "navigation": {
            "nextEl": ".swiper-button-next",
            "prevEl": ".swiper-button-prev"
          },
          "breakpoints": {
            "320": { 
              "slidesPerView": 2, 
              "spaceBetween": 15 
            },
            "480": { 
              "slidesPerView": 3, 
              "spaceBetween": 20 
            },
            "640": { 
              "slidesPerView": 4, 
              "spaceBetween": 25 
            },
            "768": { 
              "slidesPerView": 5, 
              "spaceBetween": 30 
            },
            "992": { 
              "slidesPerView": 6, 
              "spaceBetween": 35 
            },
            "1200": { 
              "slidesPerView": 7, 
              "spaceBetween": 40 
            }
          }
        }
      </script>

      <!-- Contenedor del carrusel -->
      <div class="swiper-wrapper align-items-center">
        {% for categoria in categorias %}
        <div class="swiper-slide">
          <a href="{% url 'productos_list' %}?categoria={{ categoria.id_categoria }}"
            class="text-decoration-none text-dark d-block w-100 h-100">
            {{ categoria.nombre_categoria }}
          </a>
        </div>
        {% endfor %}
      </div>

      <!-- Flechas de navegaci√≥n -->
      <div class="swiper-button-next"></div>
      <div class="swiper-button-prev"></div>

      <!-- Puntos de paginaci√≥n -->
      <div class="swiper-pagination"></div>
    </div>
    {% else %}
    <div class="text-center py-4">
      <p class="text-muted">No hay categor√≠as disponibles en este momento.</p>
    </div>
    {% endif %}
  </div>
</section>


<section id="services" class="services section">
  <div class="container section-title" data-aos="fade-up">
    <h2>Conecta en Gifter‚Äôs</h2>
    {% if solicitudes_recibidas %}
    <div class="mb-2">
      <h3 class="h6">Solicitudes recibidas</h3>
    </div>
    <div class="row gy-3 mb-4">
      {% for s in solicitudes_recibidas %}
      <div class="col-md-6">
        <div class="d-flex align-items-center gap-3">
          <strong>@{{ s.emisor.nombre_usuario }}</strong>
          <form method="post" action="{% url 'amistad_aceptar' s.emisor.nombre_usuario %}">
            {% csrf_token %}
            <button class="btn btn-success btn-sm">Aceptar</button>
          </form>
          <form method="post" action="{% url 'amistad_cancelar' s.emisor.nombre_usuario %}">
            {% csrf_token %}
            <button class="btn btn-outline-secondary btn-sm">Rechazar</button>
          </form>
        </div>
      </div>
      {% endfor %}
    </div>
    {% endif %}

    {% if solicitudes_enviadas %}
    <div class="mb-2">
      <h3 class="h6">Solicitudes enviadas</h3>
    </div>
    <div class="row gy-3 mb-4">
      {% for s in solicitudes_enviadas %}
      <div class="col-md-6">
        <div class="d-flex align-items-center gap-3">
          <span>Para @{{ s.receptor.nombre_usuario }}</span>
          <form method="post" action="{% url 'amistad_cancelar' s.receptor.nombre_usuario %}">
            {% csrf_token %}
            <button class="btn btn-outline-danger btn-sm">Cancelar</button>
          </form>
        </div>
      </div>
      {% endfor %}
    </div>
    {% endif %}
    <p><span>Explora tu red</span> <span class="description-title">Amigos y sugerencias</span></p>
  </div>

  <div class="container">
    {% if request.user.is_authenticated %}
    {% if amigos %}
    <div class="mb-2">
      <h3 class="h5">Tus amigos</h3>
    </div>

    <div class="row gy-4 mb-5">
      {% for a in amigos %}
      <div class="col-lg-4 col-md-6" data-aos="fade-up" data-aos-delay="{{ forloop.counter0|add:1 }}00">
        <div class="service-item position-relative">
          <div>
            {% if a.perfil and a.perfil.profile_picture %}
            <img src="{{ a.perfil.profile_picture.url }}" alt="{{ a.nombre }} {{ a.apellido }}" height="100" width="100"
              style="object-fit:cover;border-radius:50%;">
            {% else %}
            <img src="{% static 'img/Gifters/favicongift.png' %}" alt="{{ a.nombre }} {{ a.apellido }}" height="100"
              width="100" style="object-fit:cover;border-radius:50%;">
            {% endif %}
          </div>

          <a href="{% url 'perfil_detalle' a.nombre_usuario %}" class="stretched-link">
            <h3>{{ a.nombre }} {{ a.apellido }}</h3>
          </a>
          <p class="text-muted">@{{ a.nombre_usuario }}</p>

          <div class="mt-2 d-flex gap-2">
            <!--<a href="{% url 'perfil_detalle' a.nombre_usuario %}" class="btn btn-outline-primary btn-sm">Ver perfil</a>
            <a href="{% url 'chat_con_usuario' a.nombre_usuario %}" class="btn btn-primary btn-sm">Chatear</a>-->
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
    {% else %}
    <div class="text-center py-2">
      <p class="text-muted">A√∫n no tienes amigos agregados. ¬°Empieza enviando solicitudes! üëá</p>
    </div>
    {% endif %}

    {# -------------------- QUIZ√ÅS CONOZCAS -------------------- #}
    <div class="mb-2">
      <h3 class="h5">Personas que quiz√°s conozcas</h3>
    </div>

    {% if sugerencias %}
    <div class="row gy-4">
      {% for u in sugerencias %}
      <div class="col-lg-4 col-md-6" data-aos="fade-up" data-aos-delay="{{ forloop.counter0|add:1 }}00">
        <div class="service-item position-relative">
          <div>
            {% if u.perfil and u.perfil.profile_picture %}
            <img src="{{ u.perfil.profile_picture.url }}" alt="{{ u.nombre }} {{ u.apellido }}" height="100" width="100"
              style="object-fit:cover;border-radius:50%;">
            {% else %}
            <img src="{% static 'img/Gifters/favicongift.png' %}" alt="{{ u.nombre }} {{ u.apellido }}" height="100"
              width="100" style="object-fit:cover;border-radius:50%;">
            {% endif %}
          </div>

          <a href="{% url 'perfil_detalle' u.nombre_usuario %}" class="stretched-link">
            <h3>{{ u.nombre }} {{ u.apellido }}</h3>
          </a>
          <p class="text-muted">@{{ u.nombre_usuario }}</p>

          <div class="mt-2 d-flex gap-2">
            <!--<a href="{% url 'perfil_detalle' u.nombre_usuario %}" class="btn btn-outline-primary btn-sm">Ver perfil</a>
            <form method="post" action="{% url 'amistad_enviar' u.nombre_usuario %}">
              {% csrf_token %}
              <button type="submit" class="btn btn-primary btn-sm">Agregar amigo</button>-->
            </form>
          </div>

        </div>
      </div>
      {% endfor %}
    </div>
    {% else %}
    <div class="text-center py-3">
      <p class="text-muted">No hay sugerencias por ahora. Explora m√°s perfiles para obtener mejores recomendaciones.</p>
    </div>
    {% endif %}

    {% else %}
    <div class="text-center py-3">
      <p class="text-muted">Inicia sesi√≥n para ver a tus amigos y sugerencias de personas que podr√≠as conocer.</p>
    </div>
    {% endif %}
  </div>
</section>

<!-- Tendencias - AHORA CON PRODUCTOS DESTACADOS -->
<section id="portfolio" class="portfolio section">
  <div class="container section-title" data-aos="fade-up">
    <h2>Tendencias</h2>
    <p><span>&nbsp;</span> <span class="description-title">Productos m√°s populares</span></p>
  </div>

  <div class="container">
    <div class="isotope-layout" data-default-filter="*" data-layout="masonry" data-sort="original-order">
      <div class="row gy-4 isotope-container" data-aos="fade-up" data-aos-delay="200">
        {% for producto in productos_destacados %}
        <div class="col-lg-4 col-md-6 portfolio-item isotope-item filter-app">

          <!-- Imagen del producto -->
          <div class="product-image-container" style="height: 250px; overflow: hidden; border-radius: 8px;">
            {% if producto.imagen and producto.imagen.url %}
            <img src="{{ producto.imagen.url }}" class="img-fluid" alt="{{ producto.nombre_producto }}"
              style="width: 100%; height: 100%; object-fit: cover;">
            {% else %}
            <img src="{% static 'img/Gifters/favicongift.png' %}" class="img-fluid" alt="{{ producto.nombre_producto }}"
              style="width: 100%; height: 100%; object-fit: cover;">
            {% endif %}
          </div>

          <div class="portfolio-info">
            <h4>{{ producto.nombre_producto }}</h4>
            <p class="text-primary">{{ producto.id_marca.nombre_marca }}</p>

            {% if producto.precio %}
            <p class="h5 text-success">${{ producto.precio }}</p>
            {% endif %}

            <!-- Botones -->
            <div class="product-actions">
              <!-- Lupa para ampliar -->
              {% if producto.imagen and producto.imagen.url %}
              <a href="{{ producto.imagen.url }}" class="glightbox preview-link"
                data-gallery="gal-producto-{{ producto.id_producto }}">
                <i class="bi bi-zoom-in"></i>
              </a>
              {% else %}
              <a href="{% static 'img/Gifters/favicongift.png' %}" class="glightbox preview-link"
                data-gallery="gal-producto-{{ producto.id_producto }}">
                <i class="bi bi-zoom-in"></i>
              </a>
              {% endif %}

              <!-- Link a la tienda -->
              {% with producto.urls_tienda_activas.first as url_tienda %}
              {% if url_tienda %}
              <a href="{{ url_tienda.url }}" target="_blank" rel="noopener" class="details-link">
                <i class="bi bi-link-45deg"></i>
              </a>
              {% else %}
              <!-- Si no hay URL de tienda, link al detalle del producto -->
              <a href="{% url 'producto_detalle' producto.id_producto %}" class="details-link">
                <i class="bi bi-eye"></i>
              </a>
              {% endif %}
              {% endwith %}
            </div>
          </div>

        </div>
        {% empty %}
        <div class="col-12 text-center">
          <div class="alert alert-info">
            <h4>üì¶ No hay productos destacados</h4>
            <p>Pronto agregaremos nuevos productos interesantes.</p>
            <a href="{% url 'productos_list' %}" class="btn btn-primary mt-2">Explorar todos los productos</a>
          </div>
        </div>
        {% endfor %}
      </div>
    </div>

    <!-- Bot√≥n para ver m√°s productos -->
    {% if productos_destacados %}
    <div class="text-center mt-4">
      <a href="{% url 'productos_list' %}" class="btn btn-primary">Ver todos los productos</a>
    </div>
    {% endif %}
  </div>
</section>



<div class="container section-title" data-aos="fade-up">
  <h2>Rese√±as de nuestros usuarios</h2>
</div>

<!-- Testimonials -->
<section id="testimonials" class="testimonials section dark-background">
  <img src="{% static 'img/Gifters/fondo.png' %}" class="testimonials-bg" alt="">
  <div class="container" data-aos="fade-up" data-aos-delay="100">
    <div class="swiper init-swiper">
      <script type="application/json" class="swiper-config">
          { "loop": true, "speed": 600, "autoplay": { "delay": 5000 }, "slidesPerView": "auto",
            "pagination": { "el": ".swiper-pagination", "type": "bullets", "clickable": true } }
        </script>
      <div class="swiper-wrapper">
        <div class="swiper-slide">
          <div class="testimonial-item">
            <img src="{% static 'img/testimonials/testimonials-1.jpg' %}" class="testimonial-img" alt="">
            <h3>Saul Goodman</h3>
            <h4>Ceo &amp; Founder</h4>
            <div class="stars"><i class="bi bi-star-fill"></i><i class="bi bi-star-fill"></i><i
                class="bi bi-star-fill"></i><i class="bi bi-star-fill"></i><i class="bi bi-star-fill"></i></div>
            <p><i class="bi bi-quote quote-icon-left"></i>
              <span>Proin iaculis purus consequat sem...</span>
              <i class="bi bi-quote quote-icon-right"></i>
            </p>
          </div>
        </div>

        <div class="swiper-slide">
          <div class="testimonial-item">
            <img src="{% static 'img/testimonials/testimonials-2.jpg' %}" class="testimonial-img" alt="">
            <h3>Sara Wilsson</h3>
            <h4>Designer</h4>
            <div class="stars"><i class="bi bi-star-fill"></i><i class="bi bi-star-fill"></i><i
                class="bi bi-star-fill"></i><i class="bi bi-star-fill"></i><i class="bi bi-star-fill"></i></div>
            <p><i class="bi bi-quote quote-icon-left"></i>
              <span>Export tempor illum tamen malis...</span>
              <i class="bi bi-quote quote-icon-right"></i>
            </p>
          </div>
        </div>

        <div class="swiper-slide">
          <div class="testimonial-item">
            <img src="{% static 'img/testimonials/testimonials-3.jpg' %}" class="testimonial-img" alt="">
            <h3>Jena Karlis</h3>
            <h4>Store Owner</h4>
            <div class="stars"><i class="bi bi-star-fill"></i><i class="bi bi-star-fill"></i><i
                class="bi bi-star-fill"></i><i class="bi bi-star-fill"></i><i class="bi bi-star-fill"></i></div>
            <p><i class="bi bi-quote quote-icon-left"></i>
              <span>Enim nisi quem export duis labore...</span>
              <i class="bi bi-quote quote-icon-right"></i>
            </p>
          </div>
        </div>

        <div class="swiper-slide">
          <div class="testimonial-item">
            <img src="{% static 'img/testimonials/testimonials-4.jpg' %}" class="testimonial-img" alt="">
            <h3>Matt Brandon</h3>
            <h4>Freelancer</h4>
            <div class="stars"><i class="bi bi-star-fill"></i><i class="bi bi-star-fill"></i><i
                class="bi bi-star-fill"></i><i class="bi bi-star-fill"></i><i class="bi bi-star-fill"></i></div>
            <p><i class="bi bi-quote quote-icon-left"></i>
              <span>Fugiat enim eram quae cillum dolore...</span>
              <i class="bi bi-quote quote-icon-right"></i>
            </p>
          </div>
        </div>

        <div class="swiper-slide">
          <div class="testimonial-item">
            <img src="{% static 'img/testimonials/testimonials-5.jpg' %}" class="testimonial-img" alt="">
            <h3>John Larson</h3>
            <h4>Entrepreneur</h4>
            <div class="stars"><i class="bi bi-star-fill"></i><i class="bi bi-star-fill"></i><i
                class="bi bi-star-fill"></i><i class="bi bi-star-fill"></i><i class="bi bi-star-fill"></i></div>
            <p><i class="bi bi-quote quote-icon-left"></i>
              <span>Quis quorum aliqua sint quem legam...</span>
              <i class="bi bi-quote quote-icon-right"></i>
            </p>
          </div>
        </div>
      </div>
      <div class="swiper-pagination"></div>
    </div>
  </div>
</section>

<!-- Contact -->
<section id="contact" class="contact section">
  <div class="container section-title">
    <h2>Contacto</h2>
    <p><span>¬øNecesitas ayuda?</span> <span class="description-title"></span></p>
    <a href="ayuda.html" class="gift">Contactanos!</a>
  </div>
</section>

{% endblock %}
